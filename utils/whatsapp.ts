
import { Sale, db, User, Customer, Category, InventoryItem, clearAllData } from '../db.ts';
import pako from 'pako';

const MASTER_SALT = "NaijaPOS_2025_Sec" + "ret_Keep_Safe_99";

export const formatNaira = (amount: number) => {
  return new Intl.NumberFormat('en-NG', {
    style: 'currency',
    currency: 'NGN',
    minimumFractionDigits: 0
  }).format(amount);
};

export const shareReceiptToWhatsApp = async (sale: Sale) => {
  // Fetch latest business details from DB
  const snSetting = await db.settings.get('shop_name');
  const saSetting = await db.settings.get('shop_address');
  
  const shopName = snSetting?.value || localStorage.getItem('shop_name') || 'NaijaShop';
  const shopInfo = saSetting?.value || localStorage.getItem('shop_info') || '';
  
  const date = new Date(sale.timestamp).toLocaleString('en-NG', {
    dateStyle: 'medium',
    timeStyle: 'short'
  });
  
  const transId = sale.id ? String(sale.id).padStart(5, '0') : 'N/A';

  let message = `ðŸ›ï¸ *${shopName.toUpperCase()}*\n`;
  if (shopInfo) message += `ðŸ“ ${shopInfo}\n`;
  message += `--------------------------\n`;
  message += `ðŸ“œ *RECEIPT #${transId}*\n`;
  message += `ðŸ“… Date: ${date}\n`;
  message += `--------------------------\n`;
  message += `ðŸ“¦ *ITEMS:*\n`;
  
  sale.items.forEach(item => {
    const itemTotal = item.price * item.quantity;
    message += `â€¢ ${item.name} x ${item.quantity} ... ${formatNaira(itemTotal)}\n`;
  });
  
  message += `--------------------------\n`;
  
  // The "Smart" Receipt Breakdown
  message += `ðŸ’° *Total Bill: ${formatNaira(sale.total)}*\n`;

  if (sale.walletUsed && sale.walletUsed > 0) {
    message += `ðŸ’³ Paid from Wallet: -${formatNaira(sale.walletUsed)}\n`;
  }

  if (sale.cashPaid && sale.cashPaid > 0) {
    message += `ðŸ’µ Cash Paid: ${formatNaira(sale.cashPaid)}\n`;
  }
  
  if (sale.paymentMethod === 'Debt' || sale.paymentMethod === 'Partial') {
    const remainingDebt = Math.max(0, sale.total - (sale.walletUsed || 0) - (sale.cashPaid || 0));
    message += `--------------------------\n`;
    message += `âš ï¸ *BALANCE OWED (DEBT): ${formatNaira(remainingDebt)}*\n`;
    message += `*Please kindly clear your balance soon. Thank you!*\n`;
    message += `ðŸ“Œ Status: Partially Settled\n`;
  } else if (sale.paymentMethod === 'Wallet' && (sale.walletUsed || 0) + (sale.cashPaid || 0) >= sale.total) {
    message += `âœ… Fully Settled via Wallet/Cash\n`;
  } else {
    const totalPayment = (sale.walletUsed || 0) + (sale.cashPaid || 0);
    message += `âœ… Total Paid: ${formatNaira(totalPayment)}\n`;
  }
  
  message += `--------------------------\n`;

  if (sale.customer_phone) {
    const customer = await db.customers.where('phone').equals(sale.customer_phone).first();
    if (sale.walletSaved && sale.walletSaved > 0) {
      message += `âœ¨ Change Saved to Wallet: +${formatNaira(sale.walletSaved)}\n`;
    }
    if (customer) {
      message += `ðŸ¦ Your Wallet Balance: ${formatNaira(customer.walletBalance)}\n`;
    }
    message += `--------------------------\n`;
  }

  message += `ðŸ™ *Thank you for your business!*\n`;
  message += `\n_Generated by NaijaShop POS_ ðŸ‡³ðŸ‡¬`;

  const encodedMessage = encodeURIComponent(message);
  window.open(`https://api.whatsapp.com/send?text=${encodedMessage}`, '_blank');
};

/**
 * Generates a full shop setup key (Inventory + Staff Users + License)
 */
export const generateShopKey = async () => {
  const inventory = await db.inventory.toArray();
  const users = await db.users.toArray();
  const sn = await db.settings.get('shop_name');
  const sa = await db.settings.get('shop_address');
  const shopName = sn?.value || localStorage.getItem('shop_name') || 'NaijaShop';
  const shopInfo = sa?.value || localStorage.getItem('shop_info') || '';
  const license_expiry = localStorage.getItem('license_expiry');
  const license_signature = localStorage.getItem('license_signature');

  const payload = {
    inventory, 
    users,
    settings: { shopName, shopInfo, license_expiry, license_signature }
  };

  const jsonStr = JSON.stringify(payload);
  const base64 = btoa(encodeURIComponent(jsonStr).replace(/%([0-9A-F]{2})/g, (match, p1) => 
    String.fromCharCode(parseInt(p1, 16))
  ));
  
  const key = `SHOP-KEY-${base64}`;
  const message = `ðŸš€ *Shop Setup Key for ${shopName}*\n\nCopy the text below and paste it into your Shop Manager app.\n\n${key}`;

  try {
    await navigator.clipboard.writeText(key);
    alert('Setup Key copied to clipboard!');
  } catch (err) {
    console.error('Clipboard failed', err);
  }

  if (navigator.share && key.length < 1500) {
    try {
      await navigator.share({ title: 'Staff Setup Key', text: message });
    } catch (e) {
      window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`, '_blank');
    }
  } else {
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message.substring(0, 1500))}`, '_blank');
  }
};

/**
 * Updated Staff Invite Generator
 * Now creates a full onboarding URL for one-tap setup.
 */
export const generateStaffInviteKey = async (user: User) => {
  const sn = await db.settings.get('shop_name');
  const shopName = sn?.value || localStorage.getItem('shop_name') || 'NaijaShop';
  const expiry = localStorage.getItem('license_expiry') || '';
  const license_signature = localStorage.getItem('license_signature') || '';

  // Fetch current Soft POS settings
  const bankSetting = await db.settings.get('softPosBank');
  const numberSetting = await db.settings.get('softPosNumber');
  const accountSetting = await db.settings.get('softPosAccount');

  const data = { 
    shopName, 
    staffName: user.name, 
    staffPin: user.pin, 
    expiry, 
    license_signature,
    softPosBank: bankSetting?.value || '',
    softPosNumber: numberSetting?.value || '',
    softPosAccount: accountSetting?.value || '',
    role: 'staff', 
    secret: 'NAIJA_VERIFIED' 
  };

  const base64String = btoa(JSON.stringify(data));
  const inviteLink = window.location.origin + '/join?key=' + base64String;
  
  const message = `ðŸ‘‹ *Hello ${user.name},*\n\nBoss has added you to *${shopName}* on NaijaShop. Click the private link below to set up your terminal automatically:\n\nðŸ”— ${inviteLink}\n\n_Keep this link secret._`;

  if (navigator.share) {
    try {
      await navigator.share({ title: 'NaijaShop Staff Invite', text: message });
    } catch (e) {
      window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`, '_blank');
    }
  } else {
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`, '_blank');
  }
};

/**
 * Processes a staff invite URL key
 */
export const processStaffInvite = async (base64Key: string) => {
  try {
    const jsonStr = atob(base64Key);
    const data = JSON.parse(jsonStr);

    if (data.secret !== 'NAIJA_VERIFIED') throw new Error("Invalid invite key");

    // 1. Clear existing local data for fresh setup
    await clearAllData();

    // 2. Set Device & User Configuration
    localStorage.setItem('user_role', 'staff');
    localStorage.setItem('device_role', 'StaffDevice');
    localStorage.setItem('shop_name', data.shopName);
    localStorage.setItem('is_activated', 'true');
    localStorage.setItem('license_expiry', data.expiry);
    localStorage.setItem('license_signature', data.license_signature);
    localStorage.setItem('is_setup_pending', 'false'); // Bypass setup wizard

    // 3. Save to database for persistence
    await db.users.add({
      name: data.staffName,
      pin: data.staffPin,
      role: 'Staff'
    });

    if (data.softPosBank) await db.settings.put({ key: 'softPosBank', value: data.softPosBank });
    if (data.softPosNumber) await db.settings.put({ key: 'softPosNumber', value: data.softPosNumber });
    if (data.softPosAccount) await db.settings.put({ key: 'softPosAccount', value: data.softPosAccount });
    
    await db.security.put({ key: 'license_expiry', value: data.expiry });
    await db.security.put({ key: 'license_signature', value: data.license_signature });

    return { success: true, shopName: data.shopName };
  } catch (e) {
    console.error("Invite processing failed", e);
    return { success: false, error: (e as Error).message };
  }
};

export const generateMasterStockKey = async () => {
  const inventory = await db.inventory.toArray();
  const sn = await db.settings.get('shop_name');
  const shopName = sn?.value || localStorage.getItem('shop_name') || 'NaijaShop';

  const payload = {
    inventory,
    type: 'STOCK_UPDATE',
    timestamp: Date.now()
  };

  const jsonStr = JSON.stringify(payload);
  const base64 = btoa(encodeURIComponent(jsonStr).replace(/%([0-9A-F]{2})/g, (match, p1) => 
    String.fromCharCode(parseInt(p1, 16))
  ));
  
  const key = `STOCK-SYNC-${base64}`;
  const message = `ðŸ“¦ *Master Stock Update: ${shopName}*\n\n${key}`;

  if (navigator.share && key.length < 1500) {
    try {
      await navigator.share({ title: 'Stock Update Key', text: message });
    } catch (e) {
      window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`, '_blank');
    }
  } else {
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(message.substring(0, 1500))}`, '_blank');
  }
};

export const decodeShopKey = (key: string) => {
  const trimmedKey = key.trim();
  const isSetup = trimmedKey.includes('SHOP-KEY-');
  const isStock = trimmedKey.includes('STOCK-SYNC-');
  const isStaffInvite = trimmedKey.includes('STAFF-INVITE-');
  
  if (!isSetup && !isStock && !isStaffInvite) return null;
  
  try {
    const match = trimmedKey.match(/(?:SHOP-KEY-|STOCK-SYNC-|STAFF-INVITE-)([A-Za-z0-9+/=]+)/);
    if (!match) return null;
    
    const base64 = match[1];
    
    // For the simple STAFF-INVITE format, we use standard atob
    if (isStaffInvite) {
      const jsonStr = atob(base64);
      return { ...JSON.parse(jsonStr), type: 'STAFF_INVITE' };
    }

    // For other keys, use the URI component decoder
    const jsonStr = decodeURIComponent(Array.prototype.map.call(atob(base64), (c: any) => 
      '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
    ).join(''));
    
    return JSON.parse(jsonStr);
  } catch (e) {
    console.error('Decode error:', e);
    return null;
  }
};

export const backupToWhatsApp = async (data: any, excludePhotos = false): Promise<BackupResult> => {
  const finalData = excludePhotos ? {
    ...data,
    inventory: data.inventory.map(({image, ...rest}: any) => rest),
    categories: data.categories.map(({image, ...rest}: any) => rest)
  } : data;

  const jsonString = JSON.stringify(finalData);
  const sizeMB = jsonString.length / (1024 * 1024);
  const isLarge = sizeMB > 30;

  if (isLarge && !excludePhotos) {
    if (confirm(`âš ï¸ LARGE BACKUP: Your backup is ${Math.round(sizeMB)}MB because of product photos. This might be hard to send on slow network. Backup without photos instead?`)) {
      return backupToWhatsApp(data, true);
    }
  }

  const shopName = data.shopName || 'NaijaShop';
  const timestamp = data.timestamp || Date.now();
  const dateStr = new Date(timestamp).toISOString().split('T')[0];
  const fileName = `NAIJASHOP_BACKUP_${excludePhotos ? 'LITE_' : ''}${dateStr}.json.gz`;
  
  const totalRecords = Object.values(finalData).reduce((acc: number, val: any) => {
    return acc + (Array.isArray(val) ? val.length : 0);
  }, 0) as number;

  const uint8Data = new TextEncoder().encode(jsonString);
  const compressed = pako.gzip(uint8Data);
  
  const shareTitle = `Shop Backup: ${shopName}`;
  const shareText = `Compressed Secure Shop Backup for ${dateStr}. ${excludePhotos ? '(Text Only)' : '(Includes Photos)'}`;

  if (navigator.share) {
    try {
      const blob = new Blob([compressed], { type: 'application/gzip' });
      const file = new File([blob], fileName, { type: 'application/gzip' });
      await navigator.share({ title: shareTitle, text: shareText, files: [file] });
      await db.settings.put({ key: 'last_backup_timestamp', value: Date.now() });
      return { success: true, method: 'FILE_SHARE', fileName, totalRecords, isLarge };
    } catch (stage1Error) {
      console.warn("Share files failed, falling back to text...");
    }
  }

  try {
    const blob = new Blob([compressed], { type: 'application/gzip' });
    const url = URL.createObjectURL(blob);
    const anchor = document.createElement('a');
    anchor.href = url;
    anchor.download = fileName;
    document.body.appendChild(anchor);
    anchor.click();
    document.body.removeChild(anchor);
    URL.revokeObjectURL(url);
    
    await db.settings.put({ key: 'last_backup_timestamp', value: Date.now() });
    return { success: true, method: 'DOWNLOAD', fileName, totalRecords, isLarge };
  } catch (stage3Error) {
    return { success: false, method: 'DOWNLOAD' };
  }
};

/**
 * Reconcile Staff Sales Logic
 * Merges Sales, Debts, and Customer Wallets from Staff report into Admin's master ledger.
 */
export const reconcileStaffSales = async (staffData: any, adminName: string = 'Admin') => {
  const staffSales = staffData.sales || [];
  const staffDebts = staffData.debts || [];
  const staffCustomers = staffData.customers || [];
  
  let mergedCount = 0;
  let skippedCount = 0;
  let debtsAdded = 0;
  let walletsSynced = 0;

  await db.transaction('rw', [db.inventory, db.sales, db.customers, db.debts, db.stock_logs], async () => {
    // 1. Process Sales (Merges history and handles stock deduction)
    for (const sale of staffSales) {
      const existing = await db.sales.where('uuid').equals(sale.uuid).first();
      if (existing) {
        skippedCount++;
        continue;
      }

      for (const item of sale.items) {
        let invItem = await db.inventory.get(item.id);
        if (!invItem) invItem = await db.inventory.where('name').equals(item.name).first();

        if (invItem) {
          const newStock = Math.max(0, (invItem.stock || 0) - item.quantity);
          await db.inventory.update(invItem.id!, { stock: newStock });
          
          await db.stock_logs.add({
            item_id: invItem.id!,
            itemName: invItem.name,
            quantityChanged: -item.quantity,
            previousStock: invItem.stock,
            newStock: newStock,
            type: 'Sales Deduction',
            date: Date.now(),
            staff_name: sale.staff_name || adminName
          });
        }
      }

      const { id, ...saleWithoutOldId } = sale;
      await db.sales.add(saleWithoutOldId);
      mergedCount++;
    }

    // 2. Process Debts (Duplicate protection via sale_uuid or primary key)
    for (const debt of staffDebts) {
      let isDuplicate = false;
      if (debt.sale_uuid) {
        const existing = await db.debts.where('sale_uuid').equals(debt.sale_uuid).first();
        if (existing) isDuplicate = true;
      }

      if (!isDuplicate) {
        const { id, ...debtWithoutOldId } = debt;
        await db.debts.add(debtWithoutOldId);
        debtsAdded++;
      }
    }

    // 3. Process Customer Wallets (Unique key: Phone Number)
    for (const sCustomer of staffCustomers) {
      const existing = await db.customers.where('phone').equals(sCustomer.phone).first();
      if (existing) {
        // Timestamp resolution: Trust the record that was updated more recently
        const staffTs = Number(sCustomer.lastTransaction || 0);
        const adminTs = Number(existing.lastTransaction || 0);

        if (staffTs > adminTs) {
          await db.customers.update(existing.id!, {
            walletBalance: sCustomer.walletBalance,
            lastTransaction: staffTs,
            name: sCustomer.name 
          });
          walletsSynced++;
        }
      } else {
        // Completely new customer added by staff
        const { id, ...custWithoutOldId } = sCustomer;
        await db.customers.add({
          ...custWithoutOldId,
          lastTransaction: Number(custWithoutOldId.lastTransaction || Date.now())
        });
        walletsSynced++;
      }
    }
  });

  return { 
    success: true, 
    merged: mergedCount, 
    skipped: skippedCount, 
    debtsAdded, 
    walletsSynced 
  };
};

/**
 * Export Staff Sales Report
 * Filters for today's data to keep sync files lightweight.
 */
export const exportStaffSalesReport = async (sales: Sale[]) => {
  const sn = await db.settings.get('shop_name');
  const shopName = sn?.value || localStorage.getItem('shop_name') || 'NaijaShop';
  const dateStr = new Date().toISOString().split('T')[0];
  const fileName = `SALES_REPORT_${shopName}_${dateStr}.json.gz`;
  
  const startOfDay = new Date().setHours(0,0,0,0);

  // Fetch today's debts and customers updated since start of day
  const debts = await db.debts.where('date').aboveOrEqual(startOfDay).toArray();
  
  const customers = await db.customers
    .where('lastTransaction')
    .aboveOrEqual(startOfDay)
    .toArray();

  const payload = { 
    sales, 
    debts,
    customers,
    shopName, 
    type: 'STAFF_REPORT', 
    timestamp: Date.now() 
  };

  const jsonString = JSON.stringify(payload);
  const uint8Data = new TextEncoder().encode(jsonString);
  const compressed = pako.gzip(uint8Data);

  if (navigator.share) {
    try {
      const blob = new Blob([compressed], { type: 'application/gzip' });
      const file = new File([blob], fileName, { type: 'application/gzip' });
      await navigator.share({
        title: `Sales Report: ${shopName}`,
        text: `Boss, here is my report for ${dateStr}. Contains Sales, Debts and Wallet updates.`,
        files: [file]
      });
      return { success: true };
    } catch (e) {
      console.error('Share failed', e);
    }
  }

  const blob = new Blob([compressed], { type: 'application/gzip' });
  const url = URL.createObjectURL(blob);
  const anchor = document.createElement('a');
  anchor.href = url;
  anchor.download = fileName;
  document.body.appendChild(anchor);
  anchor.click();
  document.body.removeChild(anchor);
  URL.revokeObjectURL(url);
  return { success: true };
};

/**
 * Pushes the inventory update to staff via WhatsApp
 * Includes staff users (excluding Admin) to sync credentials.
 */
export const pushInventoryUpdateToStaff = async (resetStock: boolean = false) => {
  const inventory = await db.inventory.toArray();
  const categories = await db.categories.toArray();
  const staffUsers = await db.users.where('role').equals('Staff').toArray();
  
  const sn = await db.settings.get('shop_name');
  const shopName = sn?.value || localStorage.getItem('shop_name') || 'NaijaShop';
  const dateStr = new Date().toISOString().split('T')[0];
  const fileName = `NAIJASHOP_UPDATE_${dateStr}.json`;

  const bankSetting = await db.settings.get('softPosBank');
  const numberSetting = await db.settings.get('softPosNumber');
  const accountSetting = await db.settings.get('softPosAccount');

  const inventoryData = inventory.map(item => ({
    id: item.id,
    name: item.name,
    costPrice: item.costPrice,
    sellingPrice: item.sellingPrice,
    stock: item.stock,
    minStock: item.minStock,
    expiryDate: item.expiryDate,
    category: item.category,
    barcode: item.barcode,
    image: item.image, 
    dateAdded: item.dateAdded
  }));

  const categoryData = categories.map(cat => ({
    id: cat.id,
    name: cat.name,
    image: cat.image, 
    dateCreated: cat.dateCreated
  }));

  const payload = {
    type: 'INVENTORY_UPDATE',
    shopName,
    timestamp: Date.now(),
    inventory: inventoryData,
    categories: categoryData,
    staffUsers, // Include updated staff list
    resetStock,
    softPosBank: bankSetting?.value || '',
    softPosNumber: numberSetting?.value || '',
    softPosAccount: accountSetting?.value || ''
  };

  const jsonString = JSON.stringify(payload);
  const blob = new Blob([jsonString], { type: 'application/json' });
  const file = new File([blob], fileName, { type: 'application/json' });

  const message = "Hello Team, I have updated the shop inventory and staff profiles. Please click the file below and select 'Update Shop Inventory' in your app.";

  if (navigator.share) {
    try {
      await navigator.share({
        title: `Shop Update: ${shopName}`,
        text: message,
        files: [file]
      });
      return true;
    } catch (err) {
      console.warn("Navigator share failed, falling back to download");
    }
  }

  const url = URL.createObjectURL(blob);
  const anchor = document.createElement('a');
  anchor.href = url;
  anchor.download = fileName;
  document.body.appendChild(anchor);
  anchor.click();
  document.body.removeChild(anchor);
  URL.revokeObjectURL(url);
  
  const encodedMessage = encodeURIComponent(message);
  window.open(`https://api.whatsapp.com/send?text=${encodedMessage}`, '_blank');
  return true;
};

/**
 * Merges the inventory update on the staff device
 * Enforces profile changes/deletions and forces logout if current user affected.
 */
export const applyInventoryUpdate = async (data: any) => {
  if (data.type !== 'INVENTORY_UPDATE') {
    throw new Error('Invalid update file type');
  }

  let added = 0;
  let updated = 0;
  const resetStock = data.resetStock === true;

  // Track if current logged in staff is affected
  let shouldLogout = false;
  const currentStaffName = localStorage.getItem('logged_in_staff_name');

  await db.transaction('rw', [db.inventory, db.categories, db.settings, db.users], async () => {
    // 1. Sync Soft POS
    if (data.softPosBank !== undefined) await db.settings.put({ key: 'softPosBank', value: data.softPosBank });
    if (data.softPosNumber !== undefined) await db.settings.put({ key: 'softPosNumber', value: data.softPosNumber });
    if (data.softPosAccount !== undefined) await db.settings.put({ key: 'softPosAccount', value: data.softPosAccount });

    // 2. Sync Categories
    if (data.categories) {
      for (const cat of data.categories) {
        const { id, ...catWithoutId } = cat;
        const existing = await db.categories.where('name').equals(cat.name).first();
        if (existing) {
          await db.categories.update(existing.id!, catWithoutId);
        } else {
          await db.categories.add(catWithoutId);
        }
      }
    }

    // 3. Sync Inventory
    if (data.inventory) {
      for (const item of data.inventory) {
        const { id, stock, ...itemData } = item;
        const existing = await db.inventory.get(id);

        if (existing) {
          const updatePayload = resetStock ? { ...itemData, stock } : itemData;
          await db.inventory.update(id, updatePayload);
          updated++;
        } else {
          const byName = await db.inventory.where('name').equals(item.name).first();
          if (byName) {
            const updatePayload = resetStock ? { ...itemData, stock } : itemData;
            await db.inventory.update(byName.id!, updatePayload);
            updated++;
          } else {
            const { id: bossId, ...newProduct } = item; 
            await db.inventory.add(newProduct);
            added++;
          }
        }
      }
    }

    // 4. Sync Staff Users & Enforce Access
    if (data.staffUsers) {
      // Find current user's local record before wipe
      let currentLocalStaff = null;
      if (currentStaffName) {
        currentLocalStaff = await db.users.where('name').equals(currentStaffName).first();
      }

      // Clear local staff (preserve Admin)
      await db.users.where('role').equals('Staff').delete();
      
      // Re-add incoming staff
      for (const staff of data.staffUsers) {
        const { id, ...staffData } = staff;
        await db.users.add(staffData);
      }

      // Check if current user still exists and if credentials changed
      if (currentStaffName) {
        const updatedStaffRecord = data.staffUsers.find((u: any) => u.name === currentStaffName);
        if (!updatedStaffRecord || (currentLocalStaff && currentLocalStaff.pin !== updatedStaffRecord.pin)) {
          shouldLogout = true;
        }
      }
    }
  });

  if (shouldLogout) {
    alert("Security Update: Your Boss has updated your profile or removed your access. Please log in again.");
    localStorage.removeItem('user_role');
    localStorage.removeItem('logged_in_staff_name');
    window.location.reload();
  }

  localStorage.setItem('last_inventory_sync', Date.now().toString());
  return { added, updated };
};

export type BackupResult = {
  success: boolean;
  method: 'FILE_SHARE' | 'TEXT_SHARE' | 'DOWNLOAD';
  fileName?: string;
  totalRecords?: number;
  isLarge?: boolean;
};
